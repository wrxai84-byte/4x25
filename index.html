<!DOCTYPE html>
<html lang="en" prefix="og: http://ogp.me/ns#">
<head>
    <!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-8GJYYGEB88"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-8GJYYGEB88');
</script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <!-- SEO: æ ¸å¿ƒå…ƒæ•°æ® -->
    <title>4x25 - Permanent Portfolio & FIRE Calculator</title>
    <meta name="description" content="Free tool for Harry Browne's Permanent Portfolio strategy and the FIRE 4% Rule.">
    <meta name="keywords" content="Permanent Portfolio, Harry Browne, Rebalancing Calculator, FIRE, 4% Rule, Financial Independence, Asset Allocation, 4x25">
    <meta name="author" content="4x25">
    <link rel="canonical" href="https://4x25.org/">

    <!-- SEO: ç¤¾äº¤åª’ä½“ä¼˜åŒ– -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://4x25.org/">
    <meta property="og:title" content="4x25 - Permanent Portfolio & FIRE Calculator">
    <meta property="og:description" content="Free tool for Harry Browne's Permanent Portfolio strategy and the FIRE 4% Rule.">
    <meta property="og:image" content="https://4x25.org/og-image.png">
    
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="4x25 - Permanent Portfolio & FIRE Calculator">
    <meta name="twitter:description" content="Free tool for Harry Browne's Permanent Portfolio strategy and the FIRE 4% Rule.">

    <!-- æ ·å¼ä¸è„šæœ¬ -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <!-- SEO: ç»“æ„åŒ–æ•°æ® (JSON-LD) -->
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "SoftwareApplication",
      "name": "4x25 Permanent Portfolio Calculator",
      "operatingSystem": "Any",
      "applicationCategory": "FinanceApplication",
      "offers": {
        "@type": "Offer",
        "price": "0",
        "priceCurrency": "USD"
      },
      "description": "A browser-based calculator for rebalancing Harry Browne's Permanent Portfolio and calculating FIRE withdrawal rates based on the 4% rule."
    }
    </script>
    
    <!-- SEO: FAQ Schema -->
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "FAQPage",
      "mainEntity": [{
        "@type": "Question",
        "name": "Why 4x25?",
        "acceptedAnswer": {
          "@type": "Answer",
          "text": "It's a double meaning: 1. Permanent Portfolio: 4 assets at 25% each. 2. FIRE Movement: The 4% Rule implies saving 25 times your annual expenses."
        }
      }, {
        "@type": "Question",
        "name": "What is the best rebalancing threshold?",
        "acceptedAnswer": {
          "@type": "Answer",
          "text": "Harry Browne recommended using a 15/35 band. This means you rebalance only when an asset drops below 15% or rises above 35% (which equals a Â±10% threshold). This calculator defaults to Â±10%, but you can adjust it at the top based on your risk tolerance."
        }
      }]
    }
    </script>

    <style>
        body { font-family: 'Inter', system-ui, -apple-system, sans-serif; }
        .lang-btn.active { background-color: #3b82f6; color: white; border-color: #3b82f6; }
        
        button:disabled {
            opacity: 0.3;
            cursor: not-allowed;
            pointer-events: none;
        }
        
        input[type=number]::-webkit-inner-spin-button, 
        input[type=number]::-webkit-outer-spin-button { 
            -webkit-appearance: none; 
            margin: 0; 
        }

        .table-cell-truncate {
            max-width: 120px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        .sr-only {
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0, 0, 0, 0);
            white-space: nowrap;
            border-width: 0;
        }

        /* FAQ åŠ¨ç”»æ ·å¼ */
        .faq-content {
            transition: max-height 0.3s ease-in-out, opacity 0.3s ease-in-out;
            max-height: 0;
            opacity: 0;
            overflow: hidden;
        }
        .faq-content.open {
            max-height: 500px;
            opacity: 1;
        }
        .faq-icon {
            transition: transform 0.3s ease;
        }
        .faq-icon.rotate {
            transform: rotate(180deg);
        }

        /* Modal åŠ¨ç”» */
        .modal-overlay {
            transition: opacity 0.3s ease;
        }
        .modal-content {
            transition: transform 0.3s ease, opacity 0.3s ease;
        }
    </style>
</head>
<body class="bg-gray-50 text-slate-800 min-h-screen p-4 md:p-8 flex flex-col">

    <div class="max-w-5xl mx-auto w-full flex-grow">
        <!-- å¤´éƒ¨ -->
        <header class="mb-8 flex flex-col md:flex-row md:items-center justify-between gap-4">
            <div>
                <h1 class="text-4xl font-extrabold text-slate-900 tracking-tight">4x25</h1>
                <h2 class="text-slate-500 mt-2 text-lg font-normal" data-i18n="subtitle">Permanent Portfolio Rebalancing Calculator Â· FIRE 4% Rule</h2>
            </div>
            
            <div class="flex flex-col md:flex-row gap-3 items-end md:items-center">
                <!-- è¯­è¨€åˆ‡æ¢æŒ‰é’® -->
                <div class="flex rounded-lg shadow-sm overflow-hidden border border-gray-300 bg-white">
                    <button onclick="setLanguage('en')" id="btn-en" class="lang-btn px-4 py-2 text-sm font-medium hover:bg-gray-50 transition-colors active" aria-label="Switch to English">EN</button>
                    <div class="w-px bg-gray-300"></div>
                    <button onclick="setLanguage('zh')" id="btn-zh" class="lang-btn px-4 py-2 text-sm font-medium hover:bg-gray-50 transition-colors" aria-label="Switch to Chinese">ä¸­æ–‡</button>
                </div>

                <div class="bg-white px-2 py-1.5 rounded-lg shadow-sm border border-gray-200 flex items-center gap-2 select-none">
                    <span class="text-sm font-medium text-gray-500 ml-2" data-i18n="thresholdLabel">Threshold: Â±</span>
                    <div class="flex items-center bg-gray-100 rounded-md p-1">
                        <button onclick="changeThreshold(-1)" id="btn-minus" class="w-8 h-8 flex items-center justify-center bg-white rounded shadow-sm text-slate-600 hover:text-blue-600 hover:bg-blue-50 transition-all font-bold text-lg" aria-label="Decrease Threshold">-</button>
                        <div class="w-10 text-center font-bold text-slate-800" id="threshold-display">10</div>
                        <span class="text-xs font-bold text-slate-400 mr-2">%</span>
                        <button onclick="changeThreshold(1)" id="btn-plus" class="w-8 h-8 flex items-center justify-center bg-white rounded shadow-sm text-slate-600 hover:text-blue-600 hover:bg-blue-50 transition-all font-bold text-lg" aria-label="Increase Threshold">+</button>
                    </div>
                </div>
            </div>
        </header>

        <main class="grid grid-cols-1 lg:grid-cols-12 gap-8">
            
            <!-- å·¦ä¾§è¾“å…¥ -->
            <section class="lg:col-span-5 space-y-6">
                <div class="bg-white rounded-2xl shadow-sm border border-gray-200 p-6">
                    <h3 class="text-xl font-bold mb-6 flex items-center gap-2" data-i18n="inputTitle">
                        ğŸ’° Current Holdings
                    </h3>
                    <div class="space-y-5" id="inputs-container">
                        <!-- è¾“å…¥æ¡†ç”± JS ç”Ÿæˆ -->
                    </div>
                    <div class="mt-8 pt-6 border-t border-gray-100 flex justify-between items-center overflow-hidden">
                        <span class="text-gray-500 font-medium whitespace-nowrap mr-2" data-i18n="totalValue">Total Value</span>
                        <span class="text-2xl font-bold text-slate-900 font-mono truncate" id="total-value">0</span>
                    </div>
                </div>

                <!-- å›¾è¡¨ -->
                <div class="bg-white rounded-2xl shadow-sm border border-gray-200 p-6 h-80 flex flex-col items-center justify-center relative">
                    <canvas id="myChart" aria-label="Asset Allocation Chart" role="img"></canvas>
                </div>
            </section>

            <!-- å³ä¾§ç»“æœ -->
            <section class="lg:col-span-7 space-y-6">
                
                <!-- çŠ¶æ€æç¤º -->
                <div id="status-card" class="rounded-2xl p-6 border-l-4 shadow-sm transition-all bg-emerald-50 border-emerald-500 text-emerald-900" role="alert">
                    <div class="flex items-start gap-4">
                        <div id="status-icon" class="text-2xl" aria-hidden="true">âœ…</div>
                        <div>
                            <h3 class="text-lg font-bold" id="status-title">...</h3>
                            <p class="mt-1 text-sm" id="status-desc">...</p>
                        </div>
                    </div>
                </div>

                <!-- è¡¨æ ¼ -->
                <div class="bg-white rounded-2xl shadow-sm border border-gray-200 overflow-hidden">
                    <div class="p-6 border-b border-gray-100 flex justify-between items-center">
                        <h3 class="text-xl font-bold" data-i18n="rebalanceTitle">ğŸ”„ Rebalancing Suggestions</h3>
                        <span class="text-xs font-mono bg-gray-100 text-gray-600 px-2 py-1 rounded" data-i18n="targetLabel">Target: 25%</span>
                    </div>
                    <div class="overflow-x-auto">
                        <table class="w-full text-left border-collapse">
                            <caption class="sr-only">Asset Rebalancing Table</caption>
                            <thead>
                                <tr class="bg-gray-50 text-gray-500 text-sm uppercase tracking-wider">
                                    <th class="p-4 font-medium whitespace-nowrap" data-i18n="colAsset">Asset</th>
                                    <th class="p-4 font-medium text-right whitespace-nowrap" data-i18n="colCurrent">Current %</th>
                                    <th class="p-4 font-medium text-right whitespace-nowrap" data-i18n="colTarget">Target Value</th>
                                    <th class="p-4 font-medium text-right whitespace-nowrap" data-i18n="colAction">Action</th>
                                </tr>
                            </thead>
                            <tbody class="divide-y divide-gray-100" id="result-body">
                                <!-- ç»“æœç”± JS ç”Ÿæˆ -->
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- FIRE è®¡ç®— -->
                <div class="bg-slate-900 text-white rounded-2xl p-6 shadow-lg overflow-hidden">
                    <h3 class="text-lg font-bold mb-2" data-i18n="fireTitle">FIRE 4% Rule Preview</h3>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mt-4">
                        <div class="overflow-hidden">
                            <p class="text-slate-400 text-sm mb-1" data-i18n="fireYear">Safe Annual Withdrawal</p>
                            <p class="text-3xl font-mono font-bold text-emerald-400 truncate" id="fire-year">0</p>
                        </div>
                        <div class="overflow-hidden">
                            <p class="text-slate-400 text-sm mb-1" data-i18n="fireMonth">Safe Monthly Withdrawal</p>
                            <p class="text-2xl font-mono font-bold text-emerald-400 truncate" id="fire-month">0</p>
                        </div>
                    </div>
                </div>

                <!-- 4% æ³•åˆ™ç®€ä»‹ -->
                <article class="bg-white rounded-2xl shadow-sm border border-gray-200 p-6">
                    <h3 class="text-base font-bold text-slate-900 mb-2 flex items-center gap-2">
                        <span class="text-blue-500" aria-hidden="true">â„¹ï¸</span> <span data-i18n="fireRuleTitle">About the 4% Rule</span>
                    </h3>
                    <div class="text-sm text-slate-600 leading-relaxed" data-i18n="fireRuleText">
                        <!-- å†…å®¹ç”± JS å¡«å…… -->
                    </div>
                </article>

            </section>
        </main>

        <!-- åº•éƒ¨ä»‹ç» (SEO å†…å®¹åŒº) -->
        <article class="mt-10 bg-white rounded-2xl shadow-sm border border-gray-200 p-8">
            <h2 class="text-2xl font-bold text-slate-900 mb-4" data-i18n="introTitle">What is the Permanent Portfolio?</h2>
            <div class="prose text-slate-600 max-w-none leading-relaxed mb-10" data-i18n="introText">
                <!-- å†…å®¹ç”± JS å¡«å…… -->
            </div>
            
            <!-- FAQ åŒºåŸŸ -->
            <div class="border-t border-gray-100 pt-8">
                <h3 class="text-xl font-bold text-slate-800 mb-6" data-i18n="faqTitle">Frequently Asked Questions (FAQ)</h3>
                <div id="faq-container" class="space-y-4">
                     <!-- FAQ å†…å®¹ç”± JS åŠ¨æ€ç”Ÿæˆ -->
                </div>
            </div>
        </article>
    </div>

    <!-- åº•éƒ¨ Footer -->
    <footer class="mt-12 text-center pb-8 px-4 border-t border-gray-100 pt-8">
        <p class="text-slate-400 text-sm mb-2">
            &copy; 2026 4x25 Â· 
            <!-- ä¿®æ”¹ç‚¹ï¼šæ·»åŠ  onclick äº‹ä»¶ï¼Œæ ·å¼æ”¹ä¸º cursor-pointer -->
            <button onclick="openPrivacyModal()" class="cursor-pointer hover:text-slate-600 transition-colors underline decoration-slate-300 underline-offset-2" data-i18n="privacy">Privacy Policy</button>
        </p>
        <p class="text-slate-400 text-xs max-w-2xl mx-auto leading-relaxed opacity-80" data-i18n="disclaimer">
            Disclaimer: This tool is for informational purposes only and does not constitute financial advice. Invest at your own risk.
        </p>
    </footer>

    <!-- éšç§æ”¿ç­– Modal (æ–°å¢) -->
    <div id="privacy-modal" class="fixed inset-0 z-50 hidden" aria-labelledby="modal-title" role="dialog" aria-modal="true">
        <!-- èƒŒæ™¯é®ç½© -->
        <div class="modal-overlay absolute inset-0 bg-slate-900/50 backdrop-blur-sm transition-opacity opacity-0" onclick="closePrivacyModal()"></div>
        
        <!-- Modal å†…å®¹ -->
        <div class="flex min-h-full items-center justify-center p-4 text-center sm:p-0">
            <div class="modal-content relative transform overflow-hidden rounded-2xl bg-white text-left shadow-xl transition-all sm:my-8 sm:w-full sm:max-w-lg opacity-0 translate-y-4 sm:translate-y-0 sm:scale-95">
                <div class="bg-white px-4 pb-4 pt-5 sm:p-6 sm:pb-4">
                    <div class="sm:flex sm:items-start">
                        <div class="mt-3 text-center sm:ml-4 sm:mt-0 sm:text-left w-full">
                            <h3 class="text-xl font-bold leading-6 text-slate-900 mb-4" id="modal-title" data-i18n="privacyTitle">Privacy Policy</h3>
                            <div class="mt-2 text-sm text-slate-600 space-y-3 leading-relaxed" data-i18n="privacyContent">
                                <!-- å†…å®¹ç”± JS å¡«å…… -->
                            </div>
                        </div>
                    </div>
                </div>
                <div class="bg-gray-50 px-4 py-3 sm:flex sm:flex-row-reverse sm:px-6">
                    <button type="button" onclick="closePrivacyModal()" class="inline-flex w-full justify-center rounded-lg bg-blue-600 px-3 py-2 text-sm font-semibold text-white shadow-sm hover:bg-blue-500 sm:ml-3 sm:w-auto transition-colors" data-i18n="closeBtn">Close</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // --- å›½é™…åŒ–é…ç½® (i18n) ---
        let currentLang = 'en'; 

        const translations = {
            zh: {
                symbol: 'Â¥', 
                subtitle: "æ°¸ä¹…æŠ•èµ„ç»„åˆå†å¹³è¡¡è®¡ç®—å™¨ Â· FIRE 4% æ³•åˆ™", 
                thresholdLabel: "å†å¹³è¡¡é˜ˆå€¼: Â±",
                inputTitle: "ğŸ’° å½“å‰æŒä»“è¾“å…¥",
                totalValue: "æ€»èµ„äº§ä»·å€¼",
                rebalanceTitle: "ğŸ”„ å†å¹³è¡¡æ“ä½œå»ºè®®",
                targetLabel: "ç›®æ ‡å æ¯”: 25%",
                colAsset: "èµ„äº§",
                colCurrent: "å½“å‰å æ¯”",
                colTarget: "ç›®æ ‡é‡‘é¢",
                colAction: "æ“ä½œ",
                fireTitle: "FIRE 4% æ³•åˆ™é¢„è§ˆ",
                fireYear: "å¯æ”¯æŒå¹´æ”¯å‡º",
                fireMonth: "å¯æ”¯æŒæœˆæ”¯å‡º",
                stocks: "è‚¡ç¥¨ (Stocks)",
                bonds: "é•¿æœŸå›½å€º (Bonds)",
                cash: "ç°é‡‘/çŸ­å€º (Cash)",
                gold: "é»„é‡‘ (Gold)",
                buy: "ä¹°å…¥",
                sell: "å–å‡º",
                hold: "ä¿æŒ", 
                statusHealthyTitle: "æŠ•èµ„ç»„åˆå¤„äºå¥åº·åŒºé—´",
                statusHealthyDesc: "æ‰€æœ‰èµ„äº§å‡åœ¨ç›®æ ‡åŒºé—´å†…ï¼Œæ— éœ€æ“ä½œã€‚",
                statusActionTitle: "å»ºè®®è¿›è¡Œå†å¹³è¡¡",
                statusActionDesc: "æ£€æµ‹åˆ°æœ‰èµ„äº§åç¦»ç›®æ ‡é…ç½®è¶…è¿‡ {threshold}% (å³ <{min}% æˆ– >{max}%)ã€‚",
                fireRuleTitle: "å…³äº 4% æ³•åˆ™",
                fireRuleText: "æºè‡ª<b>ä¸‰ä¸€å­¦é™¢ç ”ç©¶</b>ã€‚æ ¸å¿ƒè§‚ç‚¹ï¼šè‹¥æ¯å¹´æå–åˆå§‹èµ„é‡‘çš„ <b>4%</b> ä½œä¸ºç”Ÿæ´»è´¹ï¼ˆå¹¶éšé€šèƒ€è°ƒæ•´ï¼‰ï¼Œèµ„é‡‘å¤§æ¦‚ç‡èƒ½ç»´æŒ 30 å¹´ä»¥ä¸Šã€‚è¿™æ„å‘³ç€ï¼šå½“<b>æ€»èµ„äº§ = å¹´æ”¯å‡º Ã— 25</b> æ—¶ï¼Œç†è®ºä¸Šå·²è¾¾æˆè´¢åŠ¡è‡ªç”±ã€‚",
                introTitle: "ä»€ä¹ˆæ˜¯æ°¸ä¹…æŠ•èµ„ç»„åˆï¼Ÿ",
                introText: `
                    <p class="mb-4">æ°¸ä¹…æŠ•èµ„ç»„åˆï¼ˆPermanent Portfolioï¼‰æ˜¯ç”±å“ˆåˆ©Â·å¸ƒæœ—ï¼ˆHarry Browneï¼‰æå‡ºçš„æŠ•èµ„ç­–ç•¥ï¼Œæ—¨åœ¨æ— è®ºç»æµçŠ¶å†µå¦‚ä½•ï¼ˆç¹è£ã€é€šç¼©ã€é€šèƒ€æˆ–æ»èƒ€ï¼‰ï¼Œéƒ½èƒ½ä¿æŠ¤å¹¶å¢å€¼ä½ çš„è´¢å¯Œã€‚</p>
                    <p class="mb-4">å…¶æ ¸å¿ƒç†å¿µæå…¶ç®€å•ï¼šå°†èµ„äº§å¹³åˆ†ä¸ºå››ç­‰ä»½ï¼ˆå„25%ï¼‰ï¼š<strong>è‚¡ç¥¨</strong>ï¼ˆåº”å¯¹ç¹è£ï¼‰ã€<strong>é•¿æœŸå›½å€º</strong>ï¼ˆåº”å¯¹é€šç¼©ï¼‰ã€<strong>ç°é‡‘/çŸ­å€º</strong>ï¼ˆåº”å¯¹è¡°é€€/ç´§ç¼©ï¼‰ã€<strong>é»„é‡‘</strong>ï¼ˆåº”å¯¹é€šèƒ€ï¼‰ã€‚</p>
                    <p>ä½ åªéœ€è¦æ¯å¹´æ£€æŸ¥ä¸€æ¬¡ï¼Œå¦‚æœæŸé¡¹èµ„äº§å æ¯”åç¦» 25% å¤ªå¤šï¼ˆä¾‹å¦‚è¶…è¿‡è®¾å®šçš„é˜ˆå€¼ï¼‰ï¼Œå°±è¿›è¡Œâ€œå†å¹³è¡¡â€ï¼šå–å‡ºæ¶¨å¾—å¤šçš„ï¼Œä¹°å…¥è·Œå¾—å¤šçš„ï¼Œä½¿å…¶å›åˆ° 25%ã€‚</p>
                `,
                faqTitle: "å¸¸è§é—®é¢˜ (FAQ)",
                faqData: [
                    {
                        question: "ä¸ºä»€ä¹ˆå« 4x25?",
                        answer: `
                            <p class="mb-2">è¿™æ˜¯ä¸€ä¸ªåŒå…³å«ä¹‰ï¼š</p>
                            <ul class="list-decimal list-inside space-y-1 ml-1">
                                <li><strong>æ°¸ä¹…æŠ•èµ„ç»„åˆï¼š</strong>4ç§èµ„äº§ï¼Œå„å  25%ã€‚</li>
                                <li><strong>FIRE è¿åŠ¨ï¼š</strong>4% æ³•åˆ™ï¼Œæ„å‘³ç€ä½ éœ€è¦å­˜å¤Ÿå¹´æ”¯å‡ºçš„ 25 å€ã€‚</li>
                            </ul>
                        `
                    },
                    {
                        question: "å†å¹³è¡¡çš„é˜ˆå€¼è®¾ä¸ºå¤šå°‘æ¯”è¾ƒå¥½?",
                        answer: `
                            <p>å“ˆåˆ©Â·å¸ƒæœ—å»ºè®®ä½¿ç”¨ <strong>15/35 é¢‘å¸¦</strong>ï¼Œå³å½“æŸé¡¹èµ„äº§è·Œç ´ 15% æˆ–æ¶¨è¶… 35% æ—¶è§¦å‘å†å¹³è¡¡ï¼ˆç›¸å½“äº Â±10% çš„é˜ˆå€¼ï¼‰ã€‚</p>
                            <p class="mt-2">æœ¬è®¡ç®—å™¨é»˜è®¤è®¾ç½®ä¸º Â±10%ï¼Œä½ å¯ä»¥æ ¹æ®è‡ªå·±çš„é£é™©åå¥½åœ¨é¡¶éƒ¨è°ƒæ•´ã€‚</p>
                        `
                    }
                ],
                privacy: "éšç§æ”¿ç­–",
                disclaimer: "å…è´£å£°æ˜ï¼šæœ¬å·¥å…·ä»…ä¾›å‚è€ƒï¼Œä¸æ„æˆä»»ä½•è´¢åŠ¡å»ºè®®ã€‚æŠ•èµ„æœ‰é£é™©ï¼Œå…¥å¸‚éœ€è°¨æ…ã€‚",
                // æ–°å¢éšç§æ”¿ç­–å†…å®¹
                privacyTitle: "éšç§æ”¿ç­–",
                privacyContent: `
                    <p><strong>1. æ•°æ®å®‰å…¨ä¸æœ¬åœ°è®¡ç®—</strong><br>æœ¬ç½‘ç«™æ˜¯ä¸€ä¸ªçº¯å‰ç«¯åº”ç”¨ã€‚æ‰€æœ‰è®¡ç®—å‡åœ¨æ‚¨çš„æµè§ˆå™¨æœ¬åœ°å®Œæˆã€‚æˆ‘ä»¬æ²¡æœ‰åç«¯æœåŠ¡å™¨ï¼Œä¹Ÿä¸ä¼šæ”¶é›†ã€å­˜å‚¨æˆ–ä¼ è¾“æ‚¨çš„ä»»ä½•è´¢åŠ¡æ•°æ®ã€‚</p>
                    <p><strong>2. Cookie ä½¿ç”¨</strong><br>æœ¬ç½‘ç«™ä¸ä½¿ç”¨ä»»ä½•ç”¨äºè¿½è¸ªä¸ªäººèº«ä»½çš„ Cookieã€‚</p>
                    <p><strong>3. ç¬¬ä¸‰æ–¹æœåŠ¡</strong><br>æœ¬ç½‘ç«™å¯èƒ½ä½¿ç”¨åŸºç¡€çš„æµé‡ç»Ÿè®¡æœåŠ¡ï¼ˆå¦‚ Google Analyticsï¼‰ä»¥ä¼˜åŒ–ç”¨æˆ·ä½“éªŒï¼Œè¿™äº›æœåŠ¡ä»…æ”¶é›†åŒ¿åæ•°æ®ï¼ˆå¦‚è®¿é—®é‡ã€æµè§ˆå™¨ç±»å‹ï¼‰ï¼Œä¸åŒ…å«ä¸ªäººè´¢åŠ¡ä¿¡æ¯ã€‚</p>
                    <p class="text-xs text-gray-400 mt-4">æœ€åæ›´æ–°æ—¥æœŸï¼š2026å¹´1æœˆ3æ—¥</p>
                `,
                closeBtn: "å…³é—­"
            },
            en: {
                symbol: '$', 
                subtitle: "Permanent Portfolio Rebalancing Calculator Â· FIRE 4% Rule",
                thresholdLabel: "Threshold: Â±",
                inputTitle: "ğŸ’° Current Holdings",
                totalValue: "Total Value",
                rebalanceTitle: "ğŸ”„ Rebalancing Suggestions",
                targetLabel: "Target: 25%",
                colAsset: "Asset",
                colCurrent: "Current %",
                colTarget: "Target Value",
                colAction: "Action",
                fireTitle: "FIRE 4% Rule Preview",
                fireYear: "Safe Annual Withdrawal",
                fireMonth: "Safe Monthly Withdrawal",
                stocks: "Stocks",
                bonds: "Long-Term Bonds",
                cash: "Cash / T-Bills",
                gold: "Gold",
                buy: "Buy",
                sell: "Sell",
                hold: "Hold",
                statusHealthyTitle: "Portfolio is Healthy",
                statusHealthyDesc: "All assets are within the target allocation range.",
                statusActionTitle: "Rebalancing Recommended",
                statusActionDesc: "Assets detected deviating by more than {threshold}% (i.e., <{min}% or >{max}%).",
                fireRuleTitle: "About the 4% Rule",
                fireRuleText: "Derived from the <b>Trinity Study</b>. It suggests that if you withdraw <b>4%</b> of your portfolio annually (adjusted for inflation), your money has a high probability of lasting 30+ years. You are 'FIRE' when <b>Assets = 25 Ã— Annual Expenses</b>.",
                introTitle: "What is the Permanent Portfolio?",
                introText: `
                    <p class="mb-4">The Permanent Portfolio is an investment strategy invented by Harry Browne, designed to preserve and grow your wealth under any economic conditionâ€”whether it's prosperity, deflation, inflation, or stagflation.</p>
                    <p class="mb-4">The core concept is simple: divide your assets equally into four parts (25% each): <strong>Stocks</strong> (for prosperity), <strong>Long-Term Bonds</strong> (for deflation), <strong>Cash</strong> (for recession), and <strong>Gold</strong> (for inflation).</p>
                    <p>You simply check it once a year. If an asset deviates too far from 25% (beyond your set threshold), you "rebalance": sell the winners and buy the losers to get back to 25%.</p>
                `,
                faqTitle: "Frequently Asked Questions (FAQ)",
                faqData: [
                    {
                        question: "Why 4x25?",
                        answer: `
                            <p class="mb-2">It's a double meaning:</p>
                            <ul class="list-decimal list-inside space-y-1 ml-1">
                                <li><strong>Permanent Portfolio:</strong> 4 assets at 25% each.</li>
                                <li><strong>FIRE Movement:</strong> The 4% Rule implies saving 25 times your annual expenses.</li>
                            </ul>
                        `
                    },
                    {
                        question: "What is the best rebalancing threshold?",
                        answer: `
                            <p>Harry Browne recommended using a <strong>15/35 band</strong>. This means you rebalance only when an asset drops below 15% or rises above 35% (which equals a Â±10% threshold).</p>
                            <p class="mt-2">This calculator defaults to Â±10%, but you can adjust it at the top based on your risk tolerance.</p>
                        `
                    }
                ],
                privacy: "Privacy Policy",
                disclaimer: "Disclaimer: This tool is for informational purposes only and does not constitute financial advice. Invest at your own risk.",
                // New Privacy Content
                privacyTitle: "Privacy Policy",
                privacyContent: `
                    <p><strong>1. Data Security & Local Processing</strong><br>This is a client-side application. All calculations are performed locally in your browser. We do not have a backend server, and we do not collect, store, or transmit any of your financial data.</p>
                    <p><strong>2. Cookies</strong><br>This website does not use cookies for tracking personal identities.</p>
                    <p><strong>3. Third-Party Services</strong><br>We may use basic analytics services (like Google Analytics) to improve user experience. These services only collect anonymous data (e.g., visitor counts, browser types) and do not access your financial inputs.</p>
                    <p class="text-xs text-gray-400 mt-4">Last Updated: January 3, 2026</p>
                `,
                closeBtn: "Close"
            }
        };

        const assetsConfig = [
            { key: 'stocks', color: '#3B82F6', value: 0 },
            { key: 'bonds', color: '#8B5CF6', value: 0 },
            { key: 'cash', color: '#10B981', value: 0 },
            { key: 'gold', color: '#F59E0B', value: 0 }
        ];

        let currentThreshold = 10;
        const MIN_THRESHOLD = 5;
        const MAX_THRESHOLD = 15;
        const MAX_DIGITS = 12;

        // --- åˆå§‹åŒ– ---

        const ctx = document.getElementById('myChart').getContext('2d');
        let myChart = new Chart(ctx, {
            type: 'doughnut',
            data: {
                labels: [], 
                datasets: [{
                    data: assetsConfig.map(a => a.value),
                    backgroundColor: assetsConfig.map(a => a.color),
                    borderWidth: 0
                }]
            },
            options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { position: 'bottom' } } }
        });

        const inputsContainer = document.getElementById('inputs-container');
        assetsConfig.forEach((asset, index) => {
            const div = document.createElement('div');
            const initialValue = asset.value === 0 ? '' : asset.value;
            
            div.innerHTML = `
                <label class="block text-sm font-medium text-gray-700 mb-1.5" id="label-${asset.key}" for="input-${asset.key}"></label>
                <div class="relative">
                    <span class="currency-symbol absolute left-3 top-1/2 -translate-y-1/2 text-gray-400 font-bold select-none"></span>
                    <input type="number" id="input-${asset.key}" step="1" min="0" placeholder="0" data-index="${index}" value="${initialValue}" 
                        oninput="if(this.value.length > ${MAX_DIGITS}) this.value = this.value.slice(0, ${MAX_DIGITS});"
                        onkeypress="return event.charCode >= 48 && event.charCode <= 57"
                        class="asset-input w-full pl-8 pr-4 py-3 bg-gray-50 border border-gray-200 rounded-xl focus:ring-2 focus:ring-blue-500 outline-none font-mono text-lg placeholder-gray-300 transition-shadow">
                </div>
            `;
            inputsContainer.appendChild(div);
        });

        // --- æ ¸å¿ƒé€»è¾‘ ---

        function changeThreshold(delta) {
            const newValue = currentThreshold + delta;
            if (newValue >= MIN_THRESHOLD && newValue <= MAX_THRESHOLD) {
                currentThreshold = newValue;
                updateThresholdUI();
                calculate();
            }
        }

        function updateThresholdUI() {
            document.getElementById('threshold-display').innerText = currentThreshold;
            document.getElementById('btn-minus').disabled = (currentThreshold <= MIN_THRESHOLD);
            document.getElementById('btn-plus').disabled = (currentThreshold >= MAX_THRESHOLD);
        }

        function toggleFaq(index) {
            const content = document.getElementById(`faq-content-${index}`);
            const icon = document.getElementById(`faq-icon-${index}`);
            
            if (content.classList.contains('open')) {
                content.classList.remove('open');
                icon.classList.remove('rotate');
            } else {
                content.classList.add('open');
                icon.classList.add('rotate');
            }
        }

        // --- Modal é€»è¾‘ ---
        function openPrivacyModal() {
            const modal = document.getElementById('privacy-modal');
            const overlay = modal.querySelector('.modal-overlay');
            const content = modal.querySelector('.modal-content');
            
            modal.classList.remove('hidden');
            // ç®€å•çš„åŠ¨ç”»å»¶è¿Ÿï¼Œè®© display:block ç”Ÿæ•ˆåå†åŠ  opacity
            setTimeout(() => {
                overlay.classList.remove('opacity-0');
                content.classList.remove('opacity-0', 'translate-y-4', 'sm:translate-y-0', 'sm:scale-95');
                content.classList.add('opacity-100', 'translate-y-0', 'sm:scale-100');
            }, 10);
        }

        function closePrivacyModal() {
            const modal = document.getElementById('privacy-modal');
            const overlay = modal.querySelector('.modal-overlay');
            const content = modal.querySelector('.modal-content');

            overlay.classList.add('opacity-0');
            content.classList.remove('opacity-100', 'translate-y-0', 'sm:scale-100');
            content.classList.add('opacity-0', 'translate-y-4', 'sm:translate-y-0', 'sm:scale-95');

            setTimeout(() => {
                modal.classList.add('hidden');
            }, 300); // ç­‰å¾…è¿‡æ¸¡ç»“æŸ
        }

        // ç›‘å¬ ESC é”®å…³é—­ Modal
        document.addEventListener('keydown', function(event) {
            if (event.key === "Escape") {
                closePrivacyModal();
            }
        });

        function setLanguage(lang) {
            currentLang = lang;
            document.documentElement.lang = lang === 'zh' ? 'zh-CN' : 'en';
            
            document.getElementById('btn-zh').classList.toggle('active', lang === 'zh');
            document.getElementById('btn-en').classList.toggle('active', lang === 'en');

            // æ›´æ–°å¸¸è§„æ–‡æœ¬
            document.querySelectorAll('[data-i18n]').forEach(el => {
                const key = el.getAttribute('data-i18n');
                if (translations[lang][key]) {
                    if (['introText', 'fireRuleText', 'privacyContent'].includes(key)) {
                        el.innerHTML = translations[lang][key];
                    } else {
                        el.innerText = translations[lang][key];
                    }
                }
            });

            // ä¸“é—¨å¤„ç† FAQ ç”Ÿæˆ
            const faqContainer = document.getElementById('faq-container');
            faqContainer.innerHTML = ''; 
            const faqData = translations[lang].faqData;
            
            faqData.forEach((item, index) => {
                const faqItem = document.createElement('div');
                faqItem.className = 'border border-gray-200 rounded-xl overflow-hidden bg-white';
                faqItem.innerHTML = `
                    <button onclick="toggleFaq(${index})" class="w-full flex justify-between items-center p-4 bg-gray-50 hover:bg-gray-100 transition-colors text-left focus:outline-none">
                        <span class="font-bold text-slate-800 text-sm md:text-base">${item.question}</span>
                        <svg id="faq-icon-${index}" class="faq-icon w-5 h-5 text-slate-400 flex-shrink-0 ml-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                        </svg>
                    </button>
                    <div id="faq-content-${index}" class="faq-content bg-white">
                        <div class="p-4 text-sm text-slate-600 leading-relaxed border-t border-gray-100">
                            ${item.answer}
                        </div>
                    </div>
                `;
                faqContainer.appendChild(faqItem);
            });

            const symbol = translations[lang].symbol;
            document.querySelectorAll('.currency-symbol').forEach(el => {
                el.innerText = symbol;
            });

            if (lang === 'en') {
                document.title = "4x25 - Permanent Portfolio & FIRE Calculator";
            } else {
                document.title = "4x25 - æ°¸ä¹…æŠ•èµ„ç»„åˆå†å¹³è¡¡è®¡ç®—å™¨ & FIRE 4%æ³•åˆ™å·¥å…·";
            }

            calculate();
        }

        function formatNumberCompact(num, lang, symbol) {
            if (num > 1000000000) { 
                return symbol + new Intl.NumberFormat(lang === 'zh' ? 'zh-CN' : 'en-US', { notation: "compact", maximumFractionDigits: 2 }).format(num);
            }
            return symbol + Math.round(num).toLocaleString(undefined, {maximumFractionDigits: 0});
        }

        function calculate() {
            const t = translations[currentLang];
            const sym = t.symbol;
            let total = 0;
            
            document.querySelectorAll('.asset-input').forEach((input, idx) => {
                let val = parseInt(input.value);
                if (isNaN(val)) val = 0;
                
                assetsConfig[idx].value = val;
                total += val;
                document.getElementById(`label-${assetsConfig[idx].key}`).innerText = t[assetsConfig[idx].key];
            });

            document.getElementById('total-value').innerText = formatNumberCompact(total, currentLang, sym);
            
            document.getElementById('fire-year').innerText = formatNumberCompact(total * 0.04, currentLang, sym);
            document.getElementById('fire-month').innerText = formatNumberCompact(total * 0.04 / 12, currentLang, sym);

            myChart.data.labels = assetsConfig.map(a => t[a.key]);
            myChart.data.datasets[0].data = assetsConfig.map(a => a.value);
            myChart.update();

            let globalNeedsRebalance = false;
            const targetPerAsset = Math.round(total / 4);

            assetsConfig.forEach(asset => {
                const currentPercent = total === 0 ? 0 : (asset.value / total) * 100;
                const isBreached = currentPercent > (25 + currentThreshold) || currentPercent < (25 - currentThreshold);
                if (isBreached) globalNeedsRebalance = true;
            });

            const tbody = document.getElementById('result-body');
            tbody.innerHTML = '';

            assetsConfig.forEach(asset => {
                const currentPercent = total === 0 ? 0 : (asset.value / total) * 100;
                const diff = targetPerAsset - asset.value;
                const isBreached = currentPercent > (25 + currentThreshold) || currentPercent < (25 - currentThreshold);

                const tr = document.createElement('tr');
                tr.className = "hover:bg-gray-50 transition-colors";
                
                let actionHtml = '';

                if (globalNeedsRebalance && total > 0) {
                    if (Math.abs(diff) > 0) {
                        const type = diff > 0 ? t.buy : t.sell;
                        const colorClass = diff > 0 ? 'bg-blue-50 text-blue-700' : 'bg-orange-50 text-orange-700';
                        actionHtml = `<div class="inline-flex items-center gap-1.5 px-3 py-1 rounded-full text-sm font-bold ${colorClass} whitespace-nowrap">
                            ${type} <span class="font-mono ml-1">${formatNumberCompact(Math.abs(diff), currentLang, '')}</span>
                        </div>`;
                    } else {
                        actionHtml = `<span class="text-gray-400 text-sm font-medium">${t.hold}</span>`;
                    }
                } else {
                    actionHtml = `<span class="text-gray-400 text-sm font-medium bg-gray-100 px-3 py-1 rounded-full">${t.hold}</span>`;
                }

                const targetDisplay = formatNumberCompact(targetPerAsset, currentLang, sym);

                tr.innerHTML = `
                    <td class="p-4"><div class="flex items-center gap-3"><div class="w-3 h-3 rounded-full flex-shrink-0" style="background-color:${asset.color}"></div><span class="font-medium text-slate-700 whitespace-nowrap">${t[asset.key]}</span></div></td>
                    <td class="p-4 text-right font-mono"><span class="${isBreached ? 'text-red-500 font-bold' : 'text-slate-600'}">${currentPercent.toFixed(1)}%</span></td>
                    <td class="p-4 text-right font-mono text-slate-600 table-cell-truncate" title="${targetDisplay}">${targetDisplay}</td>
                    <td class="p-4 text-right">${actionHtml}</td>
                `;
                tbody.appendChild(tr);
            });

            const statusCard = document.getElementById('status-card');
            const statusTitle = document.getElementById('status-title');
            const statusDesc = document.getElementById('status-desc');
            const statusIcon = document.getElementById('status-icon');

            if (globalNeedsRebalance && total > 0) {
                statusCard.className = "rounded-2xl p-6 border-l-4 shadow-sm transition-all bg-amber-50 border-amber-500 text-amber-900";
                statusIcon.innerText = "âš ï¸";
                statusTitle.innerText = t.statusActionTitle;
                statusDesc.innerText = t.statusActionDesc
                    .replace('{threshold}', currentThreshold)
                    .replace('{min}', 25 - currentThreshold)
                    .replace('{max}', 25 + currentThreshold);
            } else {
                statusCard.className = "rounded-2xl p-6 border-l-4 shadow-sm transition-all bg-emerald-50 border-emerald-500 text-emerald-900";
                statusIcon.innerText = "âœ…";
                statusTitle.innerText = t.statusHealthyTitle;
                statusDesc.innerText = t.statusHealthyDesc;
            }
        }

        document.querySelectorAll('input').forEach(input => {
            input.addEventListener('input', calculate);
        });

        // åˆå§‹åŒ–ï¼šé»˜è®¤è®¾ç½®ä¸ºè‹±æ–‡ 'en'
        setLanguage('en');
        updateThresholdUI();

    </script>
</body>
</html>
