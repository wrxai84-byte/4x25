<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-8GJYYGEB88"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-8GJYYGEB88');
</script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>4x25 - Permanent Portfolio Calculator</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body { font-family: 'Inter', system-ui, -apple-system, sans-serif; }
        .lang-btn.active { background-color: #3b82f6; color: white; border-color: #3b82f6; }
        
        button:disabled {
            opacity: 0.3;
            cursor: not-allowed;
            pointer-events: none;
        }
        
        input[type=number]::-webkit-inner-spin-button, 
        input[type=number]::-webkit-outer-spin-button { 
            -webkit-appearance: none; 
            margin: 0; 
        }

        .table-cell-truncate {
            max-width: 120px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
    </style>
</head>
<body class="bg-gray-50 text-slate-800 min-h-screen p-4 md:p-8 flex flex-col">

    <div class="max-w-5xl mx-auto w-full flex-grow">
        <!-- å¤´éƒ¨ -->
        <header class="mb-8 flex flex-col md:flex-row md:items-center justify-between gap-4">
            <div>
                <h1 class="text-4xl font-extrabold text-slate-900 tracking-tight">4x25</h1>
                <p class="text-slate-500 mt-2 text-lg" data-i18n="subtitle">æ°¸ä¹…æŠ•èµ„ç»„åˆå†å¹³è¡¡è®¡ç®—å™¨ Â· FIRE 4% æ³•åˆ™</p>
            </div>
            
            <div class="flex flex-col md:flex-row gap-3 items-end md:items-center">
                <div class="flex rounded-lg shadow-sm overflow-hidden border border-gray-300 bg-white">
                    <button onclick="setLanguage('zh')" id="btn-zh" class="lang-btn px-4 py-2 text-sm font-medium hover:bg-gray-50 transition-colors active">ä¸­æ–‡</button>
                    <div class="w-px bg-gray-300"></div>
                    <button onclick="setLanguage('en')" id="btn-en" class="lang-btn px-4 py-2 text-sm font-medium hover:bg-gray-50 transition-colors">EN</button>
                </div>

                <div class="bg-white px-2 py-1.5 rounded-lg shadow-sm border border-gray-200 flex items-center gap-2 select-none">
                    <span class="text-sm font-medium text-gray-500 ml-2" data-i18n="thresholdLabel">å†å¹³è¡¡é˜ˆå€¼: Â±</span>
                    <div class="flex items-center bg-gray-100 rounded-md p-1">
                        <button onclick="changeThreshold(-1)" id="btn-minus" class="w-8 h-8 flex items-center justify-center bg-white rounded shadow-sm text-slate-600 hover:text-blue-600 hover:bg-blue-50 transition-all font-bold text-lg">-</button>
                        <div class="w-10 text-center font-bold text-slate-800" id="threshold-display">10</div>
                        <span class="text-xs font-bold text-slate-400 mr-2">%</span>
                        <button onclick="changeThreshold(1)" id="btn-plus" class="w-8 h-8 flex items-center justify-center bg-white rounded shadow-sm text-slate-600 hover:text-blue-600 hover:bg-blue-50 transition-all font-bold text-lg">+</button>
                    </div>
                </div>
            </div>
        </header>

        <div class="grid grid-cols-1 lg:grid-cols-12 gap-8">
            
            <!-- å·¦ä¾§è¾“å…¥ -->
            <div class="lg:col-span-5 space-y-6">
                <div class="bg-white rounded-2xl shadow-sm border border-gray-200 p-6">
                    <h2 class="text-xl font-bold mb-6 flex items-center gap-2" data-i18n="inputTitle">
                        ğŸ’° å½“å‰æŒä»“è¾“å…¥
                    </h2>
                    <div class="space-y-5" id="inputs-container">
                        <!-- è¾“å…¥æ¡†ç”± JS ç”Ÿæˆ -->
                    </div>
                    <div class="mt-8 pt-6 border-t border-gray-100 flex justify-between items-center overflow-hidden">
                        <span class="text-gray-500 font-medium whitespace-nowrap mr-2" data-i18n="totalValue">æ€»èµ„äº§ä»·å€¼</span>
                        <span class="text-2xl font-bold text-slate-900 font-mono truncate" id="total-value">0</span>
                    </div>
                </div>

                <!-- å›¾è¡¨ -->
                <div class="bg-white rounded-2xl shadow-sm border border-gray-200 p-6 h-80 flex flex-col items-center justify-center relative">
                    <canvas id="myChart"></canvas>
                </div>
            </div>

            <!-- å³ä¾§ç»“æœ -->
            <div class="lg:col-span-7 space-y-6">
                
                <!-- çŠ¶æ€æç¤º -->
                <div id="status-card" class="rounded-2xl p-6 border-l-4 shadow-sm transition-all bg-emerald-50 border-emerald-500 text-emerald-900">
                    <div class="flex items-start gap-4">
                        <div id="status-icon" class="text-2xl">âœ…</div>
                        <div>
                            <h3 class="text-lg font-bold" id="status-title">...</h3>
                            <p class="mt-1 text-sm" id="status-desc">...</p>
                        </div>
                    </div>
                </div>

                <!-- è¡¨æ ¼ -->
                <div class="bg-white rounded-2xl shadow-sm border border-gray-200 overflow-hidden">
                    <div class="p-6 border-b border-gray-100 flex justify-between items-center">
                        <h2 class="text-xl font-bold" data-i18n="rebalanceTitle">ğŸ”„ å†å¹³è¡¡æ“ä½œå»ºè®®</h2>
                        <span class="text-xs font-mono bg-gray-100 text-gray-600 px-2 py-1 rounded" data-i18n="targetLabel">ç›®æ ‡å æ¯”: 25%</span>
                    </div>
                    <div class="overflow-x-auto">
                        <table class="w-full text-left border-collapse">
                            <thead>
                                <tr class="bg-gray-50 text-gray-500 text-sm uppercase tracking-wider">
                                    <th class="p-4 font-medium whitespace-nowrap" data-i18n="colAsset">èµ„äº§</th>
                                    <th class="p-4 font-medium text-right whitespace-nowrap" data-i18n="colCurrent">å½“å‰å æ¯”</th>
                                    <th class="p-4 font-medium text-right whitespace-nowrap" data-i18n="colTarget">ç›®æ ‡é‡‘é¢</th>
                                    <th class="p-4 font-medium text-right whitespace-nowrap" data-i18n="colAction">æ“ä½œ</th>
                                </tr>
                            </thead>
                            <tbody class="divide-y divide-gray-100" id="result-body">
                                <!-- ç»“æœç”± JS ç”Ÿæˆ -->
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- FIRE è®¡ç®— -->
                <div class="bg-slate-900 text-white rounded-2xl p-6 shadow-lg overflow-hidden">
                    <h3 class="text-lg font-bold mb-2" data-i18n="fireTitle">FIRE 4% æ³•åˆ™é¢„è§ˆ</h3>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mt-4">
                        <div class="overflow-hidden">
                            <p class="text-slate-400 text-sm mb-1" data-i18n="fireYear">å¯æ”¯æŒå¹´æ”¯å‡º</p>
                            <p class="text-3xl font-mono font-bold text-emerald-400 truncate" id="fire-year">0</p>
                        </div>
                        <div class="overflow-hidden">
                            <p class="text-slate-400 text-sm mb-1" data-i18n="fireMonth">å¯æ”¯æŒæœˆæ”¯å‡º</p>
                            <p class="text-2xl font-mono font-bold text-emerald-400 truncate" id="fire-month">0</p>
                        </div>
                    </div>
                </div>

                <!-- 4% æ³•åˆ™ç®€ä»‹ -->
                <div class="bg-white rounded-2xl shadow-sm border border-gray-200 p-6">
                    <h3 class="text-base font-bold text-slate-900 mb-2 flex items-center gap-2">
                        <span class="text-blue-500">â„¹ï¸</span> <span data-i18n="fireRuleTitle">å…³äº 4% æ³•åˆ™</span>
                    </h3>
                    <div class="text-sm text-slate-600 leading-relaxed" data-i18n="fireRuleText">
                        <!-- å†…å®¹ç”± JS å¡«å…… -->
                    </div>
                </div>

            </div>
        </div>

        <!-- åº•éƒ¨ä»‹ç» -->
        <div class="mt-10 bg-white rounded-2xl shadow-sm border border-gray-200 p-8">
            <h2 class="text-2xl font-bold text-slate-900 mb-4" data-i18n="introTitle">ä»€ä¹ˆæ˜¯æ°¸ä¹…æŠ•èµ„ç»„åˆï¼Ÿ</h2>
            <div class="prose text-slate-600 max-w-none leading-relaxed" data-i18n="introText">
                <!-- å†…å®¹ç”± JS å¡«å…… -->
            </div>
        </div>
    </div>

    <!-- åº•éƒ¨ Footer -->
    <footer class="mt-12 text-center pb-8 px-4 border-t border-gray-100 pt-8">
        <p class="text-slate-400 text-sm mb-2">
            &copy; 2026 4x25 Â· <span class="cursor-pointer hover:text-slate-600 transition-colors" data-i18n="privacy">éšç§æ”¿ç­–</span>
        </p>
        <p class="text-slate-400 text-xs max-w-2xl mx-auto leading-relaxed opacity-80" data-i18n="disclaimer">
            å…è´£å£°æ˜ï¼šæœ¬å·¥å…·ä»…ä¾›å‚è€ƒï¼Œä¸æ„æˆä»»ä½•è´¢åŠ¡å»ºè®®ã€‚
        </p>
    </footer>

    <script>
        // --- å›½é™…åŒ–é…ç½® (i18n) ---
        let currentLang = 'zh'; 

        const translations = {
            zh: {
                symbol: 'Â¥', 
                subtitle: "æ°¸ä¹…æŠ•èµ„ç»„åˆå†å¹³è¡¡è®¡ç®—å™¨ Â· FIRE 4% æ³•åˆ™", // ä¿®æ”¹ï¼šRule -> æ³•åˆ™
                thresholdLabel: "å†å¹³è¡¡é˜ˆå€¼: Â±",
                inputTitle: "ğŸ’° å½“å‰æŒä»“è¾“å…¥",
                totalValue: "æ€»èµ„äº§ä»·å€¼",
                rebalanceTitle: "ğŸ”„ å†å¹³è¡¡æ“ä½œå»ºè®®",
                targetLabel: "ç›®æ ‡å æ¯”: 25%", // æ–°å¢
                colAsset: "èµ„äº§",
                colCurrent: "å½“å‰å æ¯”",
                colTarget: "ç›®æ ‡é‡‘é¢",
                colAction: "æ“ä½œ",
                fireTitle: "FIRE 4% æ³•åˆ™é¢„è§ˆ",
                fireYear: "å¯æ”¯æŒå¹´æ”¯å‡º",
                fireMonth: "å¯æ”¯æŒæœˆæ”¯å‡º",
                stocks: "è‚¡ç¥¨ (Stocks)",
                bonds: "é•¿æœŸå›½å€º (Bonds)",
                cash: "ç°é‡‘/çŸ­å€º (Cash)",
                gold: "é»„é‡‘ (Gold)",
                buy: "ä¹°å…¥",
                sell: "å–å‡º",
                hold: "ä¿æŒ", 
                statusHealthyTitle: "æŠ•èµ„ç»„åˆå¤„äºå¥åº·åŒºé—´",
                statusHealthyDesc: "æ‰€æœ‰èµ„äº§å‡åœ¨ç›®æ ‡åŒºé—´å†…ï¼Œæ— éœ€æ“ä½œã€‚",
                statusActionTitle: "å»ºè®®è¿›è¡Œå†å¹³è¡¡",
                statusActionDesc: "æ£€æµ‹åˆ°æœ‰èµ„äº§åç¦»ç›®æ ‡é…ç½®è¶…è¿‡ {threshold}% (å³ <{min}% æˆ– >{max}%)ã€‚",
                fireRuleTitle: "å…³äº 4% æ³•åˆ™",
                fireRuleText: "æºè‡ª<b>ä¸‰ä¸€å­¦é™¢ç ”ç©¶</b>ã€‚æ ¸å¿ƒè§‚ç‚¹ï¼šè‹¥æ¯å¹´æå–åˆå§‹èµ„é‡‘çš„ <b>4%</b> ä½œä¸ºç”Ÿæ´»è´¹ï¼ˆå¹¶éšé€šèƒ€è°ƒæ•´ï¼‰ï¼Œèµ„é‡‘å¤§æ¦‚ç‡èƒ½ç»´æŒ 30 å¹´ä»¥ä¸Šã€‚è¿™æ„å‘³ç€ï¼šå½“<b>æ€»èµ„äº§ = å¹´æ”¯å‡º Ã— 25</b> æ—¶ï¼Œç†è®ºä¸Šå·²è¾¾æˆè´¢åŠ¡è‡ªç”±ã€‚",
                introTitle: "ä»€ä¹ˆæ˜¯æ°¸ä¹…æŠ•èµ„ç»„åˆï¼Ÿ",
                introText: `
                    <p class="mb-4">æ°¸ä¹…æŠ•èµ„ç»„åˆï¼ˆPermanent Portfolioï¼‰æ˜¯ç”±å“ˆåˆ©Â·å¸ƒæœ—ï¼ˆHarry Browneï¼‰æå‡ºçš„æŠ•èµ„ç­–ç•¥ï¼Œæ—¨åœ¨æ— è®ºç»æµçŠ¶å†µå¦‚ä½•ï¼ˆç¹è£ã€é€šç¼©ã€é€šèƒ€æˆ–æ»èƒ€ï¼‰ï¼Œéƒ½èƒ½ä¿æŠ¤å¹¶å¢å€¼ä½ çš„è´¢å¯Œã€‚</p>
                    <p class="mb-4">å…¶æ ¸å¿ƒç†å¿µæå…¶ç®€å•ï¼šå°†èµ„äº§å¹³åˆ†ä¸ºå››ç­‰ä»½ï¼ˆå„25%ï¼‰ï¼š<strong>è‚¡ç¥¨</strong>ï¼ˆåº”å¯¹ç¹è£ï¼‰ã€<strong>é•¿æœŸå›½å€º</strong>ï¼ˆåº”å¯¹é€šç¼©ï¼‰ã€<strong>ç°é‡‘/çŸ­å€º</strong>ï¼ˆåº”å¯¹è¡°é€€/ç´§ç¼©ï¼‰ã€<strong>é»„é‡‘</strong>ï¼ˆåº”å¯¹é€šèƒ€ï¼‰ã€‚</p>
                    <p>ä½ åªéœ€è¦æ¯å¹´æ£€æŸ¥ä¸€æ¬¡ï¼Œå¦‚æœæŸé¡¹èµ„äº§å æ¯”åç¦» 25% å¤ªå¤šï¼ˆä¾‹å¦‚è¶…è¿‡è®¾å®šçš„é˜ˆå€¼ï¼‰ï¼Œå°±è¿›è¡Œâ€œå†å¹³è¡¡â€ï¼šå–å‡ºæ¶¨å¾—å¤šçš„ï¼Œä¹°å…¥è·Œå¾—å¤šçš„ï¼Œä½¿å…¶å›åˆ° 25%ã€‚</p>
                `,
                privacy: "éšç§æ”¿ç­–",
                disclaimer: "å…è´£å£°æ˜ï¼šæœ¬å·¥å…·ä»…ä¾›å‚è€ƒï¼Œä¸æ„æˆä»»ä½•è´¢åŠ¡å»ºè®®ã€‚"
            },
            en: {
                symbol: '$', 
                subtitle: "Permanent Portfolio Rebalancing Calculator Â· FIRE 4% Rule",
                thresholdLabel: "Threshold: Â±",
                inputTitle: "ğŸ’° Current Holdings",
                totalValue: "Total Value",
                rebalanceTitle: "ğŸ”„ Rebalancing Suggestions",
                targetLabel: "Target: 25%", // æ–°å¢
                colAsset: "Asset",
                colCurrent: "Current %",
                colTarget: "Target Value",
                colAction: "Action",
                fireTitle: "FIRE 4% Rule Preview",
                fireYear: "Safe Annual Withdrawal",
                fireMonth: "Safe Monthly Withdrawal",
                stocks: "Stocks",
                bonds: "Long-Term Bonds",
                cash: "Cash / T-Bills",
                gold: "Gold",
                buy: "Buy",
                sell: "Sell",
                hold: "Hold",
                statusHealthyTitle: "Portfolio is Healthy",
                statusHealthyDesc: "All assets are within the target allocation range.",
                statusActionTitle: "Rebalancing Recommended",
                statusActionDesc: "Assets detected deviating by more than {threshold}% (i.e., <{min}% or >{max}%).",
                fireRuleTitle: "About the 4% Rule",
                fireRuleText: "Derived from the <b>Trinity Study</b>. It suggests that if you withdraw <b>4%</b> of your portfolio annually (adjusted for inflation), your money has a high probability of lasting 30+ years. You are 'FIRE' when <b>Assets = 25 Ã— Annual Expenses</b>.",
                introTitle: "What is the Permanent Portfolio?",
                introText: `
                    <p class="mb-4">The Permanent Portfolio is an investment strategy invented by Harry Browne, designed to preserve and grow your wealth under any economic conditionâ€”whether it's prosperity, deflation, inflation, or stagflation.</p>
                    <p class="mb-4">The core concept is simple: divide your assets equally into four parts (25% each): <strong>Stocks</strong> (for prosperity), <strong>Long-Term Bonds</strong> (for deflation), <strong>Cash</strong> (for recession), and <strong>Gold</strong> (for inflation).</p>
                    <p>You simply check it once a year. If an asset deviates too far from 25% (beyond your set threshold), you "rebalance": sell the winners and buy the losers to get back to 25%.</p>
                `,
                privacy: "Privacy Policy",
                disclaimer: "Disclaimer: This tool is for informational purposes only and does not constitute financial advice."
            }
        };

        // åˆå§‹å€¼è®¾ä¸ºç©ºï¼Œæ–¹ä¾¿ç”¨æˆ·ç›´æ¥è¾“å…¥ï¼Œæˆ–è€…è®¾ä¸º0
        const assetsConfig = [
            { key: 'stocks', color: '#3B82F6', value: 0 },
            { key: 'bonds', color: '#8B5CF6', value: 0 },
            { key: 'cash', color: '#10B981', value: 0 },
            { key: 'gold', color: '#F59E0B', value: 0 }
        ];

        let currentThreshold = 10;
        const MIN_THRESHOLD = 5;
        const MAX_THRESHOLD = 15;
        const MAX_DIGITS = 12;

        // --- åˆå§‹åŒ– ---

        const ctx = document.getElementById('myChart').getContext('2d');
        let myChart = new Chart(ctx, {
            type: 'doughnut',
            data: {
                labels: [], 
                datasets: [{
                    data: assetsConfig.map(a => a.value),
                    backgroundColor: assetsConfig.map(a => a.color),
                    borderWidth: 0
                }]
            },
            options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { position: 'bottom' } } }
        });

        const inputsContainer = document.getElementById('inputs-container');
        assetsConfig.forEach((asset, index) => {
            const div = document.createElement('div');
            // å…³é”®ä¿®æ”¹ï¼šæ·»åŠ  placeholder="0"ï¼Œå¹¶ä¸”åˆå§‹ value å¦‚æœæ˜¯ 0 åˆ™æ˜¾ç¤ºä¸ºç©ºå­—ç¬¦ä¸²ä»¥ä¾¿æ˜¾ç¤º placeholder
            const initialValue = asset.value === 0 ? '' : asset.value;
            
            div.innerHTML = `
                <label class="block text-sm font-medium text-gray-700 mb-1.5" id="label-${asset.key}"></label>
                <div class="relative">
                    <span class="currency-symbol absolute left-3 top-1/2 -translate-y-1/2 text-gray-400 font-bold select-none"></span>
                    <input type="number" step="1" min="0" placeholder="0" data-index="${index}" value="${initialValue}" 
                        oninput="if(this.value.length > ${MAX_DIGITS}) this.value = this.value.slice(0, ${MAX_DIGITS});"
                        onkeypress="return event.charCode >= 48 && event.charCode <= 57"
                        class="asset-input w-full pl-8 pr-4 py-3 bg-gray-50 border border-gray-200 rounded-xl focus:ring-2 focus:ring-blue-500 outline-none font-mono text-lg placeholder-gray-300">
                </div>
            `;
            inputsContainer.appendChild(div);
        });

        // --- æ ¸å¿ƒé€»è¾‘ ---

        function changeThreshold(delta) {
            const newValue = currentThreshold + delta;
            if (newValue >= MIN_THRESHOLD && newValue <= MAX_THRESHOLD) {
                currentThreshold = newValue;
                updateThresholdUI();
                calculate();
            }
        }

        function updateThresholdUI() {
            document.getElementById('threshold-display').innerText = currentThreshold;
            document.getElementById('btn-minus').disabled = (currentThreshold <= MIN_THRESHOLD);
            document.getElementById('btn-plus').disabled = (currentThreshold >= MAX_THRESHOLD);
        }

        function setLanguage(lang) {
            currentLang = lang;
            
            document.getElementById('btn-zh').classList.toggle('active', lang === 'zh');
            document.getElementById('btn-en').classList.toggle('active', lang === 'en');

            document.querySelectorAll('[data-i18n]').forEach(el => {
                const key = el.getAttribute('data-i18n');
                if (translations[lang][key]) {
                    if (key === 'introText' || key === 'fireRuleText') {
                        el.innerHTML = translations[lang][key];
                    } else {
                        el.innerText = translations[lang][key];
                    }
                }
            });

            const symbol = translations[lang].symbol;
            document.querySelectorAll('.currency-symbol').forEach(el => {
                el.innerText = symbol;
            });

            calculate();
        }

        function formatNumberCompact(num, lang, symbol) {
            if (num > 1000000000) { 
                return symbol + new Intl.NumberFormat(lang === 'zh' ? 'zh-CN' : 'en-US', { notation: "compact", maximumFractionDigits: 2 }).format(num);
            }
            return symbol + Math.round(num).toLocaleString(undefined, {maximumFractionDigits: 0});
        }

        function calculate() {
            const t = translations[currentLang];
            const sym = t.symbol;
            let total = 0;
            
            document.querySelectorAll('.asset-input').forEach((input, idx) => {
                // å…³é”®é€»è¾‘ï¼šå¦‚æœè¾“å…¥ä¸ºç©ºï¼ŒparseInt ä¼šè¿”å› NaNï¼Œæˆ‘ä»¬å°†å…¶è§†ä¸º 0
                let val = parseInt(input.value);
                if (isNaN(val)) val = 0;
                
                assetsConfig[idx].value = val;
                total += val;
                document.getElementById(`label-${assetsConfig[idx].key}`).innerText = t[assetsConfig[idx].key];
            });

            document.getElementById('total-value').innerText = formatNumberCompact(total, currentLang, sym);
            
            document.getElementById('fire-year').innerText = formatNumberCompact(total * 0.04, currentLang, sym);
            document.getElementById('fire-month').innerText = formatNumberCompact(total * 0.04 / 12, currentLang, sym);

            myChart.data.labels = assetsConfig.map(a => t[a.key]);
            myChart.data.datasets[0].data = assetsConfig.map(a => a.value);
            myChart.update();

            let globalNeedsRebalance = false;
            const targetPerAsset = Math.round(total / 4);

            assetsConfig.forEach(asset => {
                const currentPercent = total === 0 ? 0 : (asset.value / total) * 100;
                const isBreached = currentPercent > (25 + currentThreshold) || currentPercent < (25 - currentThreshold);
                if (isBreached) globalNeedsRebalance = true;
            });

            const tbody = document.getElementById('result-body');
            tbody.innerHTML = '';

            assetsConfig.forEach(asset => {
                const currentPercent = total === 0 ? 0 : (asset.value / total) * 100;
                const diff = targetPerAsset - asset.value;
                const isBreached = currentPercent > (25 + currentThreshold) || currentPercent < (25 - currentThreshold);

                const tr = document.createElement('tr');
                tr.className = "hover:bg-gray-50 transition-colors";
                
                let actionHtml = '';

                if (globalNeedsRebalance && total > 0) { // åªæœ‰æ€»èµ„äº§å¤§äº0æ‰å»ºè®®æ“ä½œ
                    if (Math.abs(diff) > 0) {
                        const type = diff > 0 ? t.buy : t.sell;
                        const colorClass = diff > 0 ? 'bg-blue-50 text-blue-700' : 'bg-orange-50 text-orange-700';
                        actionHtml = `<div class="inline-flex items-center gap-1.5 px-3 py-1 rounded-full text-sm font-bold ${colorClass} whitespace-nowrap">
                            ${type} <span class="font-mono ml-1">${formatNumberCompact(Math.abs(diff), currentLang, '')}</span>
                        </div>`;
                    } else {
                        actionHtml = `<span class="text-gray-400 text-sm font-medium">${t.hold}</span>`;
                    }
                } else {
                    actionHtml = `<span class="text-gray-400 text-sm font-medium bg-gray-100 px-3 py-1 rounded-full">${t.hold}</span>`;
                }

                const targetDisplay = formatNumberCompact(targetPerAsset, currentLang, sym);

                tr.innerHTML = `
                    <td class="p-4"><div class="flex items-center gap-3"><div class="w-3 h-3 rounded-full flex-shrink-0" style="background-color:${asset.color}"></div><span class="font-medium text-slate-700 whitespace-nowrap">${t[asset.key]}</span></div></td>
                    <td class="p-4 text-right font-mono"><span class="${isBreached ? 'text-red-500 font-bold' : 'text-slate-600'}">${currentPercent.toFixed(1)}%</span></td>
                    <td class="p-4 text-right font-mono text-slate-600 table-cell-truncate" title="${targetDisplay}">${targetDisplay}</td>
                    <td class="p-4 text-right">${actionHtml}</td>
                `;
                tbody.appendChild(tr);
            });

            const statusCard = document.getElementById('status-card');
            const statusTitle = document.getElementById('status-title');
            const statusDesc = document.getElementById('status-desc');
            const statusIcon = document.getElementById('status-icon');

            if (globalNeedsRebalance && total > 0) {
                statusCard.className = "rounded-2xl p-6 border-l-4 shadow-sm transition-all bg-amber-50 border-amber-500 text-amber-900";
                statusIcon.innerText = "âš ï¸";
                statusTitle.innerText = t.statusActionTitle;
                statusDesc.innerText = t.statusActionDesc
                    .replace('{threshold}', currentThreshold)
                    .replace('{min}', 25 - currentThreshold)
                    .replace('{max}', 25 + currentThreshold);
            } else {
                statusCard.className = "rounded-2xl p-6 border-l-4 shadow-sm transition-all bg-emerald-50 border-emerald-500 text-emerald-900";
                statusIcon.innerText = "âœ…";
                statusTitle.innerText = t.statusHealthyTitle;
                statusDesc.innerText = t.statusHealthyDesc;
            }
        }

        document.querySelectorAll('input').forEach(input => {
            input.addEventListener('input', calculate);
        });

        setLanguage('zh');
        updateThresholdUI();

    </script>
</body>
</html>
